<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GPS Logger Simple</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <style>
    body {
      background-color: #121212;
      color: #eee;
      font-family: sans-serif;
      text-align: center;
      padding: 2rem;
    }
    button {
      display: block;
      margin: 1rem auto;
      padding: 1.2rem 2rem;
      font-size: 1.3rem;
      border: none;
      border-radius: 8px;
      background-color: #333;
      color: white;
      cursor: pointer;
      width: 80%;
      max-width: 300px;
    }
    button:hover {
      background-color: #444;
    }
    #remove {
      background-color: #882222;
      margin-top: 3rem;
    }
  </style>
</head>
<body>
  <h1>Enregistrement GPS</h1>
  <button onclick="addPoint('3x4')">Ajouter 3x4</button>
  <button onclick="addPoint('sucette')">Ajouter sucette</button>
  <button onclick="addPoint('animé')">Ajouter animé</button>
  <button onclick="exportData()">Exporter en ZIP</button>
  <button id="remove" onclick="removeLast()">Supprimer dernier point</button>

  <script>
    let points = [];
    let username = prompt("Entrez votre nom :");

    function addPoint(type) {
      if (!confirm(`Voulez-vous ajouter un point de type "${type}" ?`)) return;
      if (!navigator.geolocation) {
        alert("La géolocalisation n'est pas supportée");
        return;
      }
      navigator.geolocation.getCurrentPosition(
        (position) => {
          const { latitude, longitude } = position.coords;
          points.push({ lat: latitude, lon: longitude, type, user: username });
          alert(`Point ${type} ajouté.`);
        },
        () => alert("Erreur de géolocalisation.")
      );
    }

    function exportData() {
      if (points.length === 0) {
        alert("Aucun point à exporter.");
        return;
      }

      let gpx = `<?xml version="1.0" encoding="UTF-8"?>\n`;
      gpx += `<gpx version="1.1" creator="Simple GPS App">\n`;
      points.forEach((pt) => {
        gpx += `  <wpt lat="${pt.lat}" lon="${pt.lon}">\n`;
        gpx += `    <name>${pt.type}</name>\n`;
        gpx += `    <desc>${pt.user}</desc>\n`;
        gpx += `  </wpt>\n`;
      });
      gpx += `</gpx>`;

      const zip = new JSZip();
      zip.file(`points_${username}.gpx`, gpx);
      zip.generateAsync({ type: "blob" }).then((blob) => {
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = `points_${username}.zip`;
        a.click();
        URL.revokeObjectURL(a.href);
      });
    }

    function removeLast() {
      if (points.length === 0) {
        alert("Aucun point à retirer.");
        return;
      }
      if (confirm("Supprimer le dernier point ajouté ?")) {
        points.pop();
        alert("Dernier point supprimé.");
      }
    }
  </script>
</body>
</html>
